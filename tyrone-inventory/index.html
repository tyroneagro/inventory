<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System - Tyrone Agro Chemicals Private Limited</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ============ LOGIN PAGE ============ */
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px;
            width: 100%;
            max-width: 450px;
            display: none;
            border-top: 5px solid #2ecc71;
        }

        .login-container.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-container h1 {
            text-align: center;
            color: #2ecc71;
            margin-bottom: 10px;
            font-size: 32px;
            letter-spacing: 1px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 5px rgba(46, 204, 113, 0.3);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(46, 204, 113, 0.4);
        }

        .login-error {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        /* ============ DASHBOARD ============ */
        .dashboard-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 1600px;
            display: none;
            overflow: hidden;
            border-top: 5px solid #2ecc71;
        }

        .dashboard-container.active {
            display: block;
        }

        /* ============ HEADER ============ */
        .dashboard-header {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.2);
        }

        .dashboard-header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .logout-btn {
            background: white;
            color: #2ecc71;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #2ecc71;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* ============ TABS ============ */
        .tabs-container {
            display: flex;
            background: #f9f9f9;
            border-bottom: 3px solid #e0e0e0;
            overflow-x: auto;
            padding: 0 10px;
        }

        .tab-btn {
            padding: 15px 25px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 4px solid transparent;
            position: relative;
        }

        .tab-btn:hover {
            background: #efefef;
            color: #2ecc71;
        }

        .tab-btn.active {
            color: #2ecc71;
            border-bottom-color: #2ecc71;
            background: white;
        }

        /* ============ CONTENT SECTIONS ============ */
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* ============ FORM STYLES ============ */
        .form-section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid #2ecc71;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-row.three-col {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .form-group-wrapper {
            display: flex;
            flex-direction: column;
        }

        .form-group-wrapper label {
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group-wrapper input,
        .form-group-wrapper select,
        .form-group-wrapper textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
            background-color: #fafafa;
        }

        .form-group-wrapper input:focus,
        .form-group-wrapper select:focus,
        .form-group-wrapper textarea:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.2);
            background-color: white;
        }

        .form-group-wrapper textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* ============ BUTTONS ============ */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* ============ ALERTS ============ */
        .alert {
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
            font-weight: 600;
        }

        .alert.active {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #2ecc71;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }

        /* ============ TABLES ============ */
        .table-section {
            margin-top: 30px;
        }

        .table-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .filters-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .filter-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        thead {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        tbody tr {
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: #f0fff4;
            box-shadow: inset 0 0 10px rgba(46, 204, 113, 0.1);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state p {
            font-size: 16px;
        }

        /* ============ MODAL ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }

        .modal-header h2 {
            color: #333;
            font-size: 24px;
            margin: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close-btn:hover {
            color: #333;
        }

        .transaction-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .transaction-tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            font-size: 14px;
            transition: all 0.3s;
        }

        .transaction-tab-btn.active {
            color: #2ecc71;
            border-bottom-color: #2ecc71;
        }

        .transaction-tab-btn:hover {
            color: #2ecc71;
        }

        .transaction-content {
            display: none;
        }

        .transaction-content.active {
            display: block;
        }

        .transaction-summary {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .summary-card.inwards {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .summary-card.outwards {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .summary-card.closing {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .summary-label {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* ============ LIVE STOCK TABLE ============ */
        .stock-table {
            margin-top: 25px;
        }

        .stock-table tbody tr {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .stock-table tbody tr:hover {
            background-color: #f5f5f5;
        }

        .stock-value {
            font-weight: 600;
            color: #2ecc71;
        }

        .stock-negative {
            color: #d32f2f;
        }

        .stock-positive {
            color: #28a745;
        }

        /* ============ BATCH NUMBER FIELD ============ */
        .batch-field {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .batch-field.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============ REMARK TAG ============ */
        .remark-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }

        /* ============ LOADING SPINNER ============ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2ecc71;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 1200px) {
            .filter-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* ============ ANIMATIONS & EFFECTS ============ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(46, 204, 113, 0);
            }
        }

        .dashboard-container.active {
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            animation: fadeIn 0.3s ease-in;
        }

        /* Green highlight for active elements */
        select:focus {
            accent-color: #2ecc71;
        }

        input[type="checkbox"]:checked,
        input[type="radio"]:checked {
            accent-color: #2ecc71;
        }

        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .form-row,
            .form-row.three-col {
                grid-template-columns: 1fr;
            }

            .filter-row {
                grid-template-columns: 1fr;
            }

            .tabs-container {
                overflow-x: auto;
            }

            .tab-btn {
                padding: 12px 15px;
                font-size: 13px;
            }

            .tab-content {
                padding: 20px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 25px;
            }

            .dashboard-header h1 {
                font-size: 20px;
            }

            .tab-btn {
                padding: 10px 12px;
                font-size: 12px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ============ LOGIN PAGE ============ -->
    <div class="login-container active" id="loginContainer">
        <h1>üåø Tyrone Agro Chemicals</h1>
        <p style="text-align: center; color: #2ecc71; font-weight: 600; margin-bottom: 20px;">Inventory Management System</p>
        <div style="text-align: center; margin-bottom: 25px; font-size: 12px; color: #999;">
            <p style="margin: 3px 0;">Your Trusted Partner in Agricultural Excellence</p>
            <p style="margin: 3px 0;">Tyrone Agro Chemicals Private Limited</p>
            <p style="margin: 10px 0; font-size: 11px; color: #2ecc71;">Default: admin@tyrone.com / admin123</p>
        </div>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Email</label>
                <input 
                    type="email" 
                    id="username" 
                    placeholder="Enter admin email" 
                    required
                    value="admin@tyrone.com"
                >
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input 
                    type="password" 
                    id="password" 
                    placeholder="Enter password" 
                    required
                    value="admin123"
                >
            </div>
            <button type="submit" class="login-btn" id="loginBtn">
                <span id="loginBtnText">Login</span>
                <span id="loginBtnSpinner" class="loading" style="display: none; margin-left: 10px;"></span>
            </button>
            <div class="login-error" id="loginError"></div>
        </form>
    </div>

    <!-- ============ DASHBOARD ============ -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1>üåø Tyrone Agro Chemicals Private Limited</h1>
                <p style="font-size: 12px; margin-top: 5px; opacity: 0.9;">Inventory Management System</p>
            </div>
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <button class="tab-btn active" data-tab="product-master">üìã Product Master</button>
            <button class="tab-btn" data-tab="remark-master">üè∑Ô∏è Remark Master</button>
            <button class="tab-btn" data-tab="inwards">üì• Inwards Stock</button>
            <button class="tab-btn" data-tab="outwards">üì§ Outwards Stock</button>
            <button class="tab-btn" data-tab="live-stock">üìä Live Stock</button>
        </div>

        <!-- ============ PRODUCT MASTER TAB ============ -->
        <div class="tab-content active" id="product-master">
            <div class="alert alert-success" id="productAlert"></div>
            <div class="alert alert-error" id="productError"></div>

            <div class="form-section">
                <h2>Add New Product</h2>
                <form id="productForm">
                    <div class="form-row full">
                        <div class="form-group-wrapper">
                            <label for="productName">Product Name</label>
                            <input 
                                type="text" 
                                id="productName" 
                                placeholder="Enter product name (e.g., Milk, Oil, Flour)" 
                                required
                            >
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" id="addProductBtn">
                            <span id="addProductBtnText">Add Product</span>
                            <span id="addProductBtnSpinner" class="loading" style="display: none; margin-left: 10px;"></span>
                        </button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <div class="table-section">
                <h3>Products List</h3>
                <table id="productTable">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Product Name</th>
                            <th>Date Added</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <tr class="empty-state">
                            <td colspan="4"><p>Loading products...</p></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ REMARK MASTER TAB ============ -->
        <div class="tab-content" id="remark-master">
            <div class="alert alert-success" id="remarkAlert"></div>
            <div class="alert alert-error" id="remarkError"></div>

            <div class="form-section">
                <h2>Add New Remark</h2>
                <form id="remarkForm">
                    <div class="form-row">
                        <div class="form-group-wrapper">
                            <label for="remarkName">Remark Name *</label>
                            <input 
                                type="text" 
                                id="remarkName" 
                                placeholder="Enter remark name (e.g., Party A, Supplier X)" 
                                required
                            >
                        </div>
                        <div class="form-group-wrapper">
                            <label for="remarkType">Remark Type *</label>
                            <select id="remarkType" required>
                                <option value="">-- Select Type --</option>
                                <option value="batch">Batch Number (requires batch)</option>
                                <option value="regular">Regular Remark</option>
                            </select>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" id="addRemarkBtn">
                            <span id="addRemarkBtnText">Add Remark</span>
                            <span id="addRemarkBtnSpinner" class="loading" style="display: none; margin-left: 10px;"></span>
                        </button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <div class="table-section">
                <h3>Remarks List</h3>
                <table id="remarkTable">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Remark Name</th>
                            <th>Type</th>
                            <th>Date Added</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="remarkTableBody">
                        <tr class="empty-state">
                            <td colspan="5"><p>Loading remarks...</p></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ INWARDS STOCK TAB ============ -->
        <div class="tab-content" id="inwards">
            <div class="alert alert-success" id="inwardsAlert"></div>
            <div class="alert alert-error" id="inwardsError"></div>

            <div class="form-section">
                <h2>Record Inwards Stock</h2>
                <form id="inwardsForm">
                    <div class="form-row">
                        <div class="form-group-wrapper">
                            <label for="inwardsProduct">Select Product *</label>
                            <select id="inwardsProduct" required>
                                <option value="">-- Select Product --</option>
                            </select>
                        </div>
                        <div class="form-group-wrapper">
                            <label for="inwardsDate">Date & Time</label>
                            <input 
                                type="datetime-local" 
                                id="inwardsDate" 
                                readonly
                            >
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-wrapper">
                            <label for="inwardsQuantity">Quantity (LTR/KG) *</label>
                            <input 
                                type="number" 
                                id="inwardsQuantity" 
                                placeholder="Enter quantity" 
                                step="0.01"
                                min="0"
                                required
                            >
                        </div>
                        <div class="form-group-wrapper">
                            <label for="inwardsRemark">Remark *</label>
                            <select id="inwardsRemark" required onchange="toggleBatchField('inwards')">
                                <option value="">-- Select Remark --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-wrapper batch-field" id="inwardsBatchField">
                            <label for="inwardsBatchNumber">Batch Number *</label>
                            <input 
                                type="text" 
                                id="inwardsBatchNumber" 
                                placeholder="Enter batch number"
                            >
                        </div>
                        <div class="form-group-wrapper">
                            <label for="inwardsAdditionalRemarks">Additional Remarks</label>
                            <input 
                                type="text" 
                                id="inwardsAdditionalRemarks" 
                                placeholder="Add additional remarks (optional)"
                            >
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" id="addInwardsBtn">
                            <span id="addInwardsBtnText">Submit Inwards</span>
                            <span id="addInwardsBtnSpinner" class="loading" style="display: none; margin-left: 10px;"></span>
                        </button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <!-- Filters Section -->
            <div class="filters-container">
                <h3 style="margin-bottom: 15px; color: #333;">Filter Records</h3>
                <div class="filter-row">
                    <div class="form-group-wrapper">
                        <label for="filterInwardsProduct">Product</label>
                        <select id="filterInwardsProduct">
                            <option value="">All Products</option>
                        </select>
                    </div>
                    <div class="form-group-wrapper">
                        <label for="filterInwardsRemark">Remark</label>
                        <select id="filterInwardsRemark">
                            <option value="">All Remarks</option>
                        </select>
                    </div>
                    <div class="form-group-wrapper">
                        <label for="filterInwardsBatch">Batch Number</label>
                        <input 
                            type="text" 
                            id="filterInwardsBatch" 
                            placeholder="Enter batch number"
                        >
                    </div>
                    <div class="form-group-wrapper">
                        <button class="btn btn-warning" onclick="filterInwardsRecords()">Apply Filter</button>
                        <button class="btn btn-secondary" onclick="clearInwardsFilter()" style="margin-top: 5px;">Clear Filter</button>
                    </div>
                </div>
            </div>

            <div class="table-section">
                <h3>Inwards Records</h3>
                <table id="inwardsTable">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Product</th>
                            <th>Date & Time</th>
                            <th>Quantity</th>
                            <th>Remark</th>
                            <th>Batch No.</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="inwardsTableBody">
                        <tr class="empty-state">
                            <td colspan="7"><p>Loading inwards records...</p></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ OUTWARDS STOCK TAB ============ -->
        <div class="tab-content" id="outwards">
            <div class="alert alert-success" id="outwardsAlert"></div>
            <div class="alert alert-error" id="outwardsError"></div>

            <div class="form-section">
                <h2>Record Outwards Stock</h2>
                <form id="outwardsForm">
                    <div class="form-row">
                        <div class="form-group-wrapper">
                            <label for="outwardsProduct">Select Product *</label>
                            <select id="outwardsProduct" required>
                                <option value="">-- Select Product --</option>
                            </select>
                        </div>
                        <div class="form-group-wrapper">
                            <label for="outwardsDate">Date & Time</label>
                            <input 
                                type="datetime-local" 
                                id="outwardsDate" 
                                readonly
                            >
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-wrapper">
                            <label for="outwardsQuantity">Quantity (LTR/KG) *</label>
                            <input 
                                type="number" 
                                id="outwardsQuantity" 
                                placeholder="Enter quantity" 
                                step="0.01"
                                min="0"
                                required
                            >
                        </div>
                        <div class="form-group-wrapper">
                            <label for="outwardsRemark">Remark *</label>
                            <select id="outwardsRemark" required onchange="toggleBatchField('outwards')">
                                <option value="">-- Select Remark --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group-wrapper batch-field" id="outwardsBatchField">
                            <label for="outwardsBatchNumber">Batch Number *</label>
                            <input 
                                type="text" 
                                id="outwardsBatchNumber" 
                                placeholder="Enter batch number"
                            >
                        </div>
                        <div class="form-group-wrapper">
                            <label for="outwardsAdditionalRemarks">Additional Remarks</label>
                            <input 
                                type="text" 
                                id="outwardsAdditionalRemarks" 
                                placeholder="Add additional remarks (optional)"
                            >
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" id="addOutwardsBtn">
                            <span id="addOutwardsBtnText">Submit Outwards</span>
                            <span id="addOutwardsBtnSpinner" class="loading" style="display: none; margin-left: 10px;"></span>
                        </button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <!-- Filters Section -->
            <div class="filters-container">
                <h3 style="margin-bottom: 15px; color: #333;">Filter Records</h3>
                <div class="filter-row">
                    <div class="form-group-wrapper">
                        <label for="filterOutwardsProduct">Product</label>
                        <select id="filterOutwardsProduct">
                            <option value="">All Products</option>
                        </select>
                    </div>
                    <div class="form-group-wrapper">
                        <label for="filterOutwardsRemark">Remark</label>
                        <select id="filterOutwardsRemark">
                            <option value="">All Remarks</option>
                        </select>
                    </div>
                    <div class="form-group-wrapper">
                        <label for="filterOutwardsBatch">Batch Number</label>
                        <input 
                            type="text" 
                            id="filterOutwardsBatch" 
                            placeholder="Enter batch number"
                        >
                    </div>
                    <div class="form-group-wrapper">
                        <button class="btn btn-warning" onclick="filterOutwardsRecords()">Apply Filter</button>
                        <button class="btn btn-secondary" onclick="clearOutwardsFilter()" style="margin-top: 5px;">Clear Filter</button>
                    </div>
                </div>
            </div>

            <div class="table-section">
                <h3>Outwards Records</h3>
                <table id="outwardsTable">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Product</th>
                            <th>Date & Time</th>
                            <th>Quantity</th>
                            <th>Remark</th>
                            <th>Batch No.</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="outwardsTableBody">
                        <tr class="empty-state">
                            <td colspan="7"><p>Loading outwards records...</p></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ============ LIVE STOCK TAB ============ -->
        <div class="tab-content" id="live-stock">
            <div class="form-section">
                <h2>Current Stock Status</h2>
                <p style="color: #666; margin-bottom: 20px;">Closing Stock = Total Inwards Qty ‚àí Total Outwards Qty</p>
                <table id="liveStockTable" class="stock-table">
                    <thead>
                        <tr>
                            <th>S.No.</th>
                            <th>Product Name</th>
                            <th>Total Inwards (LTR/KG)</th>
                            <th>Total Outwards (LTR/KG)</th>
                            <th>Closing Stock (LTR/KG)</th>
                        </tr>
                    </thead>
                    <tbody id="liveStockTableBody">
                        <tr class="empty-state">
                            <td colspan="5"><p>Loading stock data...</p></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div style="background: #f5f5f5; padding: 20px; text-align: center; border-top: 1px solid #e0e0e0; margin-top: 40px;">
            <p style="color: #666; font-size: 12px; margin: 0;">
                ¬© 2024 <strong>Tyrone Agro Chemicals Private Limited</strong> | Inventory Management System | All Rights Reserved
            </p>
            <p style="color: #999; font-size: 11px; margin: 5px 0 0 0;">
                Version 2.0 | Firebase Integration | Developed with ‚ù§Ô∏è for Better Inventory Management
            </p>
        </div>
    </div>

    <!-- ============ TRANSACTION MODAL ============ -->
    <div id="transactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProductName"></h2>
                <button class="modal-close-btn" onclick="closeTransactionModal()">&times;</button>
            </div>

            <div class="transaction-tabs">
                <button class="transaction-tab-btn active" onclick="switchTransactionTab('all')">All Transactions</button>
                <button class="transaction-tab-btn" onclick="switchTransactionTab('inwards')">Inwards Only</button>
                <button class="transaction-tab-btn" onclick="switchTransactionTab('outwards')">Outwards Only</button>
            </div>

            <div id="all" class="transaction-content active">
                <div class="transaction-summary">
                    <div class="summary-card inwards">
                        <div class="summary-label">Total Inwards</div>
                        <div class="summary-value" id="totalInwardsQty">0</div>
                    </div>
                    <div class="summary-card outwards">
                        <div class="summary-label">Total Outwards</div>
                        <div class="summary-value" id="totalOutwardsQty">0</div>
                    </div>
                    <div class="summary-card closing">
                        <div class="summary-label">Closing Stock</div>
                        <div class="summary-value" id="closingStockQty">0</div>
                    </div>
                </div>
                <h3 style="margin-bottom: 15px;">All Transactions</h3>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Type</th>
                            <th>Quantity (LTR/KG)</th>
                            <th>Remark</th>
                            <th>Batch No.</th>
                        </tr>
                    </thead>
                    <tbody id="allTransactionsBody">
                        <tr class="empty-state"><td colspan="5"><p>Loading transactions...</p></td></tr>
                    </tbody>
                </table>
            </div>

            <div id="inwards" class="transaction-content">
                <h3 style="margin-bottom: 15px;">Inwards Transactions</h3>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Quantity (LTR/KG)</th>
                            <th>Remark</th>
                            <th>Batch No.</th>
                            <th>Additional Info</th>
                        </tr>
                    </thead>
                    <tbody id="inwardsTransactionsBody">
                        <tr class="empty-state"><td colspan="5"><p>No inwards transactions</p></td></tr>
                    </tbody>
                </table>
            </div>

            <div id="outwards" class="transaction-content">
                <h3 style="margin-bottom: 15px;">Outwards Transactions</h3>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Quantity (LTR/KG)</th>
                            <th>Remark</th>
                            <th>Batch No.</th>
                            <th>Additional Info</th>
                        </tr>
                    </thead>
                    <tbody id="outwardsTransactionsBody">
                        <tr class="empty-state"><td colspan="5"><p>No outwards transactions</p></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============ FIREBASE SDK ============ -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <!-- ============ JAVASCRIPT WITH FIREBASE ============ -->
    <script>
        // ============ FIREBASE CONFIGURATION ============
        const firebaseConfig = {
            apiKey: "AIzaSyDw_6YbfScPP9iAMKfy5IL-rKHLBDe2KpU",
            authDomain: "tyrone-ims.firebaseapp.com",
            projectId: "tyrone-ims",
            storageBucket: "tyrone-ims.firebasestorage.app",
            messagingSenderId: "878583465327",
            appId: "1:878583465327:web:781928500c495cc684949a",
            measurementId: "G-X9H1V5DZX2"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ============ DATA MANAGEMENT WITH FIREBASE ============
        const FirebaseManager = {
            // Products Collection
            async getProducts() {
                try {
                    const snapshot = await db.collection('products')
                        .orderBy('dateAdded', 'desc')
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error getting products:', error);
                    showAlert('productError', 'Failed to load products', 'error');
                    return [];
                }
            },

            async addProduct(product) {
                try {
                    const docRef = await db.collection('products').add(product);
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding product:', error);
                    throw error;
                }
            },

            async deleteProduct(productId) {
                try {
                    await db.collection('products').doc(productId).delete();
                    return true;
                } catch (error) {
                    console.error('Error deleting product:', error);
                    throw error;
                }
            },

            // Remarks Collection
            async getRemarks() {
                try {
                    const snapshot = await db.collection('remarks')
                        .orderBy('dateAdded', 'desc')
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error getting remarks:', error);
                    showAlert('remarkError', 'Failed to load remarks', 'error');
                    return [];
                }
            },

            async addRemark(remark) {
                try {
                    const docRef = await db.collection('remarks').add(remark);
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding remark:', error);
                    throw error;
                }
            },

            async deleteRemark(remarkId) {
                try {
                    await db.collection('remarks').doc(remarkId).delete();
                    return true;
                } catch (error) {
                    console.error('Error deleting remark:', error);
                    throw error;
                }
            },

            // Inwards Collection
            async getInwards() {
                try {
                    const snapshot = await db.collection('inwards')
                        .orderBy('dateTime', 'desc')
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error getting inwards:', error);
                    showAlert('inwardsError', 'Failed to load inwards records', 'error');
                    return [];
                }
            },

            async addInwards(inwards) {
                try {
                    const docRef = await db.collection('inwards').add(inwards);
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding inwards:', error);
                    throw error;
                }
            },

            async deleteInwards(inwardsId) {
                try {
                    await db.collection('inwards').doc(inwardsId).delete();
                    return true;
                } catch (error) {
                    console.error('Error deleting inwards:', error);
                    throw error;
                }
            },

            // Outwards Collection
            async getOutwards() {
                try {
                    const snapshot = await db.collection('outwards')
                        .orderBy('dateTime', 'desc')
                        .get();
                    
                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error getting outwards:', error);
                    showAlert('outwardsError', 'Failed to load outwards records', 'error');
                    return [];
                }
            },

            async addOutwards(outwards) {
                try {
                    const docRef = await db.collection('outwards').add(outwards);
                    return docRef.id;
                } catch (error) {
                    console.error('Error adding outwards:', error);
                    throw error;
                }
            },

            async deleteOutwards(outwardsId) {
                try {
                    await db.collection('outwards').doc(outwardsId).delete();
                    return true;
                } catch (error) {
                    console.error('Error deleting outwards:', error);
                    throw error;
                }
            }
        };

        // ============ UI UTILITIES ============
        
        function showAlert(containerId, message, type = 'success') {
            const alertElement = document.getElementById(containerId);
            alertElement.textContent = message;
            alertElement.className = `alert active alert-${type}`;
            
            setTimeout(() => {
                alertElement.classList.remove('active');
            }, 3000);
        }

        function showLoading(buttonId, show = true) {
            const btn = document.getElementById(buttonId);
            const spinner = document.getElementById(`${buttonId}Spinner`);
            const text = document.getElementById(`${buttonId}Text`);
            
            if (show) {
                spinner.style.display = 'inline-block';
                text.style.opacity = '0.5';
                btn.disabled = true;
            } else {
                spinner.style.display = 'none';
                text.style.opacity = '1';
                btn.disabled = false;
            }
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString('en-IN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        function getCurrentDateTime() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            return now.toISOString().slice(0, 16);
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate button
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update data if switching to specific tabs
            if (tabName === 'live-stock') {
                updateLiveStock();
            } else if (tabName === 'remark-master') {
                loadRemarks();
            } else if (tabName === 'inwards') {
                populateFilterDropdowns('inwards');
            } else if (tabName === 'outwards') {
                populateFilterDropdowns('outwards');
            }
        }

        // ============ AUTHENTICATION ============
        
        function showLoginPage(show) {
            document.getElementById('loginContainer').classList.toggle('active', show);
            document.getElementById('dashboardContainer').classList.toggle('active', !show);
        }

        // ============ PRODUCT MANAGEMENT ============
        
        async function loadProducts() {
            try {
                const products = await FirebaseManager.getProducts();
                renderProductsTable(products);
                updateProductDropdowns(products);
                return products;
            } catch (error) {
                console.error('Error loading products:', error);
                showAlert('productError', 'Failed to load products', 'error');
                return [];
            }
        }

        async function updateProductDropdowns(products) {
            const inwardsSelect = document.getElementById('inwardsProduct');
            const outwardsSelect = document.getElementById('outwardsProduct');
            const filterInwardsSelect = document.getElementById('filterInwardsProduct');
            const filterOutwardsSelect = document.getElementById('filterOutwardsProduct');
            
            // Preserve selected values
            const inwardsValue = inwardsSelect.value;
            const outwardsValue = outwardsSelect.value;
            const filterInwardsValue = filterInwardsSelect.value;
            const filterOutwardsValue = filterOutwardsSelect.value;
            
            // Clear and rebuild
            [inwardsSelect, outwardsSelect, filterInwardsSelect, filterOutwardsSelect].forEach(select => {
                select.innerHTML = '<option value="">-- Select Product --</option>';
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    select.appendChild(option);
                });
            });
            
            inwardsSelect.value = inwardsValue;
            outwardsSelect.value = outwardsValue;
            filterInwardsSelect.value = filterInwardsValue;
            filterOutwardsSelect.value = filterOutwardsValue;
        }

        function renderProductsTable(products) {
            const tbody = document.getElementById('productTableBody');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="4"><p>No products added yet</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map((product, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${product.name}</td>
                    <td>${formatDate(product.dateAdded)}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="deleteProduct('${product.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addProduct(name) {
            showLoading('addProductBtn', true);
            
            try {
                // Check if product already exists
                const existingProducts = await FirebaseManager.getProducts();
                if (existingProducts.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                    showAlert('productError', 'Product already exists!', 'error');
                    showLoading('addProductBtn', false);
                    return;
                }
                
                const product = {
                    name: name.trim(),
                    dateAdded: new Date().toISOString()
                };
                
                await FirebaseManager.addProduct(product);
                
                const products = await loadProducts();
                showAlert('productAlert', `‚úì Product "${name}" added successfully!`);
                document.getElementById('productForm').reset();
            } catch (error) {
                console.error('Error adding product:', error);
                showAlert('productError', 'Failed to add product. Please try again.', 'error');
            } finally {
                showLoading('addProductBtn', false);
            }
        }

        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                await FirebaseManager.deleteProduct(productId);
                
                // Delete related transactions
                await deleteProductTransactions(productId);
                
                await loadProducts();
                await loadInwards();
                await loadOutwards();
                await updateLiveStock();
                showAlert('productAlert', '‚úì Product deleted successfully!');
            } catch (error) {
                console.error('Error deleting product:', error);
                showAlert('productError', 'Failed to delete product', 'error');
            }
        }

        async function deleteProductTransactions(productId) {
            try {
                // Delete inwards records
                const inwardsSnapshot = await db.collection('inwards')
                    .where('productId', '==', productId)
                    .get();
                
                const inwardsDeletes = inwardsSnapshot.docs.map(doc => doc.ref.delete());
                
                // Delete outwards records
                const outwardsSnapshot = await db.collection('outwards')
                    .where('productId', '==', productId)
                    .get();
                
                const outwardsDeletes = outwardsSnapshot.docs.map(doc => doc.ref.delete());
                
                await Promise.all([...inwardsDeletes, ...outwardsDeletes]);
            } catch (error) {
                console.error('Error deleting product transactions:', error);
            }
        }

        // ============ REMARK MANAGEMENT ============
        
        async function loadRemarks() {
            try {
                const remarks = await FirebaseManager.getRemarks();
                renderRemarksTable(remarks);
                updateRemarkDropdowns(remarks);
                return remarks;
            } catch (error) {
                console.error('Error loading remarks:', error);
                showAlert('remarkError', 'Failed to load remarks', 'error');
                return [];
            }
        }

        async function updateRemarkDropdowns(remarks) {
            const inwardsRemark = document.getElementById('inwardsRemark');
            const outwardsRemark = document.getElementById('outwardsRemark');
            const filterInwardsRemark = document.getElementById('filterInwardsRemark');
            const filterOutwardsRemark = document.getElementById('filterOutwardsRemark');
            
            // Preserve selected values
            const inwardsValue = inwardsRemark.value;
            const outwardsValue = outwardsRemark.value;
            const filterInwardsValue = filterInwardsRemark.value;
            const filterOutwardsValue = filterOutwardsRemark.value;
            
            // Clear and rebuild
            [inwardsRemark, outwardsRemark, filterInwardsRemark, filterOutwardsRemark].forEach(select => {
                select.innerHTML = '<option value="">-- Select Remark --</option>';
                remarks.forEach(remark => {
                    const option = document.createElement('option');
                    option.value = remark.id;
                    option.textContent = remark.name + (remark.type === 'batch' ? ' (Batch)' : '');
                    select.appendChild(option);
                });
            });
            
            inwardsRemark.value = inwardsValue;
            outwardsRemark.value = outwardsValue;
            filterInwardsRemark.value = filterInwardsValue;
            filterOutwardsRemark.value = filterOutwardsValue;
        }

        function renderRemarksTable(remarks) {
            const tbody = document.getElementById('remarkTableBody');
            
            if (remarks.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5"><p>No remarks added yet</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = remarks.map((remark, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${remark.name}</td>
                    <td><span class="remark-tag">${remark.type === 'batch' ? 'Batch Number' : 'Regular'}</span></td>
                    <td>${formatDate(remark.dateAdded)}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="deleteRemark('${remark.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addRemark(name, type) {
            showLoading('addRemarkBtn', true);
            
            try {
                // Check if remark already exists
                const existingRemarks = await FirebaseManager.getRemarks();
                if (existingRemarks.some(r => r.name.toLowerCase() === name.toLowerCase())) {
                    showAlert('remarkError', 'Remark already exists!', 'error');
                    showLoading('addRemarkBtn', false);
                    return;
                }
                
                const remark = {
                    name: name.trim(),
                    type: type,
                    dateAdded: new Date().toISOString()
                };
                
                await FirebaseManager.addRemark(remark);
                
                const remarks = await loadRemarks();
                showAlert('remarkAlert', `‚úì Remark "${name}" added successfully!`);
                document.getElementById('remarkForm').reset();
            } catch (error) {
                console.error('Error adding remark:', error);
                showAlert('remarkError', 'Failed to add remark. Please try again.', 'error');
            } finally {
                showLoading('addRemarkBtn', false);
            }
        }

        async function deleteRemark(remarkId) {
            if (!confirm('Are you sure you want to delete this remark?')) return;
            
            try {
                await FirebaseManager.deleteRemark(remarkId);
                await loadRemarks();
                showAlert('remarkAlert', '‚úì Remark deleted successfully!');
            } catch (error) {
                console.error('Error deleting remark:', error);
                showAlert('remarkError', 'Failed to delete remark', 'error');
            }
        }

        // ============ BATCH FIELD TOGGLE ============
        
        async function toggleBatchField(type) {
            const remarkId = document.getElementById(`${type}Remark`).value;
            const remarks = await FirebaseManager.getRemarks();
            const remark = remarks.find(r => r.id === remarkId);
            const batchField = document.getElementById(`${type}BatchField`);
            const batchInput = document.getElementById(`${type}BatchNumber`);
            
            if (remark && remark.type === 'batch') {
                batchField.classList.add('active');
                batchInput.required = true;
            } else {
                batchField.classList.remove('active');
                batchInput.required = false;
                batchInput.value = '';
            }
        }

        // ============ INWARDS MANAGEMENT ============
        
        async function loadInwards() {
            try {
                const inwards = await FirebaseManager.getInwards();
                const products = await FirebaseManager.getProducts();
                const remarks = await FirebaseManager.getRemarks();
                renderInwardsTable(inwards, products, remarks);
                return inwards;
            } catch (error) {
                console.error('Error loading inwards:', error);
                showAlert('inwardsError', 'Failed to load inwards records', 'error');
                return [];
            }
        }

        function renderInwardsTable(inwards, products, remarks) {
            const tbody = document.getElementById('inwardsTableBody');
            
            if (inwards.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="7"><p>No inwards records yet</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = inwards.map((record, index) => {
                const product = products.find(p => p.id === record.productId);
                const remark = remarks.find(r => r.id === record.remarkId);
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${product?.name || 'Unknown'}</td>
                        <td>${formatDate(record.dateTime)}</td>
                        <td>${record.quantity}</td>
                        <td>${remark?.name || 'Unknown'}</td>
                        <td>${record.batchNumber || '-'}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="deleteInwardsRecord('${record.id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function addInwardsRecord(productId, quantity, remarkId, batchNumber, additionalRemarks, dateTime) {
            showLoading('addInwardsBtn', true);
            
            try {
                const products = await FirebaseManager.getProducts();
                const remarks = await FirebaseManager.getRemarks();
                const product = products.find(p => p.id === productId);
                const remark = remarks.find(r => r.id === remarkId);
                
                if (!product) {
                    showAlert('inwardsError', 'Please select a valid product!', 'error');
                    showLoading('addInwardsBtn', false);
                    return;
                }
                
                if (!remark) {
                    showAlert('inwardsError', 'Please select a valid remark!', 'error');
                    showLoading('addInwardsBtn', false);
                    return;
                }
                
                if (quantity <= 0) {
                    showAlert('inwardsError', 'Quantity must be greater than 0!', 'error');
                    showLoading('addInwardsBtn', false);
                    return;
                }
                
                // Check if batch number is required but not provided
                if (remark.type === 'batch' && !batchNumber.trim()) {
                    showAlert('inwardsError', 'Batch number is required for this remark!', 'error');
                    showLoading('addInwardsBtn', false);
                    return;
                }
                
                const record = {
                    productId: productId,
                    quantity: parseFloat(quantity),
                    remarkId: remarkId,
                    batchNumber: batchNumber.trim(),
                    additionalRemarks: additionalRemarks.trim(),
                    dateTime: dateTime || new Date().toISOString(),
                    createdAt: new Date().toISOString()
                };
                
                await FirebaseManager.addInwards(record);
                
                await loadInwards();
                await updateLiveStock();
                showAlert('inwardsAlert', `‚úì Inwards record for "${product.name}" added successfully!`);
                
                document.getElementById('inwardsForm').reset();
                document.getElementById('inwardsDate').value = getCurrentDateTime();
                document.getElementById('inwardsBatchField').classList.remove('active');
            } catch (error) {
                console.error('Error adding inwards record:', error);
                showAlert('inwardsError', 'Failed to add inwards record. Please try again.', 'error');
            } finally {
                showLoading('addInwardsBtn', false);
            }
        }

        async function deleteInwardsRecord(recordId) {
            if (!confirm('Are you sure you want to delete this record?')) return;
            
            try {
                await FirebaseManager.deleteInwards(recordId);
                await loadInwards();
                await updateLiveStock();
                showAlert('inwardsAlert', '‚úì Record deleted successfully!');
            } catch (error) {
                console.error('Error deleting inwards record:', error);
                showAlert('inwardsError', 'Failed to delete record', 'error');
            }
        }

        // ============ OUTWARDS MANAGEMENT ============
        
        async function loadOutwards() {
            try {
                const outwards = await FirebaseManager.getOutwards();
                const products = await FirebaseManager.getProducts();
                const remarks = await FirebaseManager.getRemarks();
                renderOutwardsTable(outwards, products, remarks);
                return outwards;
            } catch (error) {
                console.error('Error loading outwards:', error);
                showAlert('outwardsError', 'Failed to load outwards records', 'error');
                return [];
            }
        }

        function renderOutwardsTable(outwards, products, remarks) {
            const tbody = document.getElementById('outwardsTableBody');
            
            if (outwards.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="7"><p>No outwards records yet</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = outwards.map((record, index) => {
                const product = products.find(p => p.id === record.productId);
                const remark = remarks.find(r => r.id === record.remarkId);
                return `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${product?.name || 'Unknown'}</td>
                        <td>${formatDate(record.dateTime)}</td>
                        <td>${record.quantity}</td>
                        <td>${remark?.name || 'Unknown'}</td>
                        <td>${record.batchNumber || '-'}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="deleteOutwardsRecord('${record.id}')">Delete</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        async function addOutwardsRecord(productId, quantity, remarkId, batchNumber, additionalRemarks, dateTime) {
            showLoading('addOutwardsBtn', true);
            
            try {
                const products = await FirebaseManager.getProducts();
                const remarks = await FirebaseManager.getRemarks();
                const product = products.find(p => p.id === productId);
                const remark = remarks.find(r => r.id === remarkId);
                
                if (!product) {
                    showAlert('outwardsError', 'Please select a valid product!', 'error');
                    showLoading('addOutwardsBtn', false);
                    return;
                }
                
                if (!remark) {
                    showAlert('outwardsError', 'Please select a valid remark!', 'error');
                    showLoading('addOutwardsBtn', false);
                    return;
                }
                
                if (quantity <= 0) {
                    showAlert('outwardsError', 'Quantity must be greater than 0!', 'error');
                    showLoading('addOutwardsBtn', false);
                    return;
                }
                
                // Check if batch number is required but not provided
                if (remark.type === 'batch' && !batchNumber.trim()) {
                    showAlert('outwardsError', 'Batch number is required for this remark!', 'error');
                    showLoading('addOutwardsBtn', false);
                    return;
                }
                
                // Calculate current stock
                const inwards = await FirebaseManager.getInwards();
                const outwards = await FirebaseManager.getOutwards();
                
                const totalInwards = inwards
                    .filter(i => i.productId === productId)
                    .reduce((sum, i) => sum + i.quantity, 0);
                
                const totalOutwards = outwards
                    .filter(o => o.productId === productId)
                    .reduce((sum, o) => sum + o.quantity, 0);
                
                const currentStock = totalInwards - totalOutwards;
                
                // Check if stock will go negative
                if (currentStock - quantity < 0) {
                    showAlert('outwardsError', `Insufficient stock! Available: ${currentStock.toFixed(2)} ${product.name}`, 'error');
                    showLoading('addOutwardsBtn', false);
                    return;
                }
                
                const record = {
                    productId: productId,
                    quantity: parseFloat(quantity),
                    remarkId: remarkId,
                    batchNumber: batchNumber.trim(),
                    additionalRemarks: additionalRemarks.trim(),
                    dateTime: dateTime || new Date().toISOString(),
                    createdAt: new Date().toISOString()
                };
                
                await FirebaseManager.addOutwards(record);
                
                await loadOutwards();
                await updateLiveStock();
                showAlert('outwardsAlert', `‚úì Outwards record for "${product.name}" added successfully!`);
                
                document.getElementById('outwardsForm').reset();
                document.getElementById('outwardsDate').value = getCurrentDateTime();
                document.getElementById('outwardsBatchField').classList.remove('active');
            } catch (error) {
                console.error('Error adding outwards record:', error);
                showAlert('outwardsError', 'Failed to add outwards record. Please try again.', 'error');
            } finally {
                showLoading('addOutwardsBtn', false);
            }
        }

        async function deleteOutwardsRecord(recordId) {
            if (!confirm('Are you sure you want to delete this record?')) return;
            
            try {
                await FirebaseManager.deleteOutwards(recordId);
                await loadOutwards();
                await updateLiveStock();
                showAlert('outwardsAlert', '‚úì Record deleted successfully!');
            } catch (error) {
                console.error('Error deleting outwards record:', error);
                showAlert('outwardsError', 'Failed to delete record', 'error');
            }
        }

        // ============ FILTER FUNCTIONS ============
        
        async function populateFilterDropdowns(type) {
            const products = await FirebaseManager.getProducts();
            const remarks = await FirebaseManager.getRemarks();
            const productSelect = document.getElementById(`filter${type.charAt(0).toUpperCase() + type.slice(1)}Product`);
            const remarkSelect = document.getElementById(`filter${type.charAt(0).toUpperCase() + type.slice(1)}Remark`);
            
            // Clear and rebuild product filter
            productSelect.innerHTML = '<option value="">All Products</option>';
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                productSelect.appendChild(option);
            });
            
            // Clear and rebuild remark filter
            remarkSelect.innerHTML = '<option value="">All Remarks</option>';
            remarks.forEach(remark => {
                const option = document.createElement('option');
                option.value = remark.id;
                option.textContent = remark.name;
                remarkSelect.appendChild(option);
            });
        }

        async function filterInwardsRecords() {
            const productId = document.getElementById('filterInwardsProduct').value;
            const remarkId = document.getElementById('filterInwardsRemark').value;
            const batchNumber = document.getElementById('filterInwardsBatch').value.toLowerCase().trim();
            
            const inwards = await FirebaseManager.getInwards();
            const products = await FirebaseManager.getProducts();
            const remarks = await FirebaseManager.getRemarks();
            
            let filteredData = inwards;
            
            // Apply filters
            if (productId) {
                filteredData = filteredData.filter(record => record.productId === productId);
            }
            
            if (remarkId) {
                filteredData = filteredData.filter(record => record.remarkId === remarkId);
            }
            
            if (batchNumber) {
                filteredData = filteredData.filter(record => 
                    record.batchNumber && record.batchNumber.toLowerCase().includes(batchNumber)
                );
            }
            
            renderInwardsTable(filteredData, products, remarks);
            showAlert('inwardsAlert', `‚úì Filter applied. Found ${filteredData.length} records.`, 'success');
        }

        async function filterOutwardsRecords() {
            const productId = document.getElementById('filterOutwardsProduct').value;
            const remarkId = document.getElementById('filterOutwardsRemark').value;
            const batchNumber = document.getElementById('filterOutwardsBatch').value.toLowerCase().trim();
            
            const outwards = await FirebaseManager.getOutwards();
            const products = await FirebaseManager.getProducts();
            const remarks = await FirebaseManager.getRemarks();
            
            let filteredData = outwards;
            
            // Apply filters
            if (productId) {
                filteredData = filteredData.filter(record => record.productId === productId);
            }
            
            if (remarkId) {
                filteredData = filteredData.filter(record => record.remarkId === remarkId);
            }
            
            if (batchNumber) {
                filteredData = filteredData.filter(record => 
                    record.batchNumber && record.batchNumber.toLowerCase().includes(batchNumber)
                );
            }
            
            renderOutwardsTable(filteredData, products, remarks);
            showAlert('outwardsAlert', `‚úì Filter applied. Found ${filteredData.length} records.`, 'success');
        }

        async function clearInwardsFilter() {
            document.getElementById('filterInwardsProduct').value = '';
            document.getElementById('filterInwardsRemark').value = '';
            document.getElementById('filterInwardsBatch').value = '';
            
            await loadInwards();
            showAlert('inwardsAlert', '‚úì Filter cleared.', 'success');
        }

        async function clearOutwardsFilter() {
            document.getElementById('filterOutwardsProduct').value = '';
            document.getElementById('filterOutwardsRemark').value = '';
            document.getElementById('filterOutwardsBatch').value = '';
            
            await loadOutwards();
            showAlert('outwardsAlert', '‚úì Filter cleared.', 'success');
        }

        // ============ LIVE STOCK MANAGEMENT ============
        
        async function updateLiveStock() {
            const products = await FirebaseManager.getProducts();
            const inwards = await FirebaseManager.getInwards();
            const outwards = await FirebaseManager.getOutwards();
            const tbody = document.getElementById('liveStockTableBody');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5"><p>No products in inventory</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = products.map((product, index) => {
                const totalInwards = inwards
                    .filter(i => i.productId === product.id)
                    .reduce((sum, i) => sum + i.quantity, 0);
                
                const totalOutwards = outwards
                    .filter(o => o.productId === product.id)
                    .reduce((sum, o) => sum + o.quantity, 0);
                
                const closingStock = totalInwards - totalOutwards;
                const stockClass = closingStock < 0 ? 'stock-negative' : 'stock-positive';
                
                return `
                    <tr onclick="viewProductTransactions('${product.id}', '${product.name}')">
                        <td>${index + 1}</td>
                        <td><strong style="color: #667eea; text-decoration: underline; cursor: pointer;">${product.name}</strong></td>
                        <td class="stock-value">${totalInwards.toFixed(2)}</td>
                        <td class="stock-value">${totalOutwards.toFixed(2)}</td>
                        <td class="${stockClass}"><strong>${closingStock.toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // ============ TRANSACTION MODAL FUNCTIONS ============
        
        async function viewProductTransactions(productId, productName) {
            try {
                const inwards = await FirebaseManager.getInwards();
                const outwards = await FirebaseManager.getOutwards();
                const products = await FirebaseManager.getProducts();
                const remarks = await FirebaseManager.getRemarks();
                
                const filteredInwards = inwards.filter(i => i.productId === productId);
                const filteredOutwards = outwards.filter(o => o.productId === productId);
                
                const totalInwardsQty = filteredInwards.reduce((sum, i) => sum + parseFloat(i.quantity), 0);
                const totalOutwardsQty = filteredOutwards.reduce((sum, o) => sum + parseFloat(o.quantity), 0);
                const closingStock = totalInwardsQty - totalOutwardsQty;
                
                // Update modal header
                document.getElementById('modalProductName').textContent = productName;
                
                // Update summary cards
                document.getElementById('totalInwardsQty').textContent = totalInwardsQty.toFixed(2);
                document.getElementById('totalOutwardsQty').textContent = totalOutwardsQty.toFixed(2);
                document.getElementById('closingStockQty').textContent = closingStock.toFixed(2);
                
                // Populate all transactions
                populateAllTransactions(filteredInwards, filteredOutwards, products, remarks);
                
                // Populate inwards transactions
                populateInwardsTransactions(filteredInwards, products, remarks);
                
                // Populate outwards transactions
                populateOutwardsTransactions(filteredOutwards, products, remarks);
                
                // Show modal
                document.getElementById('transactionModal').classList.add('active');
                
                // Reset to all transactions tab
                switchTransactionTab('all');
            } catch (error) {
                console.error('Error loading transactions:', error);
                showAlert('productError', 'Failed to load transactions', 'error');
            }
        }

        function populateAllTransactions(inwards, outwards, products, remarks) {
            const tbody = document.getElementById('allTransactionsBody');
            
            // Combine and sort by date
            const allTransactions = [
                ...inwards.map(t => ({ ...t, type: 'Inwards' })),
                ...outwards.map(t => ({ ...t, type: 'Outwards' }))
            ].sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));
            
            if (allTransactions.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5"><p>No transactions</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = allTransactions.map(transaction => {
                const product = products.find(p => p.id === transaction.productId);
                const remark = remarks.find(r => r.id === transaction.remarkId);
                return `
                    <tr>
                        <td>${formatDate(transaction.dateTime)}</td>
                        <td><span style="padding: 5px 10px; border-radius: 5px; font-weight: 600; background: ${transaction.type === 'Inwards' ? '#d4edda' : '#f8d7da'}; color: ${transaction.type === 'Inwards' ? '#155724' : '#721c24'};'">${transaction.type}</span></td>
                        <td><strong>${parseFloat(transaction.quantity).toFixed(2)}</strong></td>
                        <td>${remark?.name || '-'} ${transaction.additionalRemarks ? `(${transaction.additionalRemarks})` : ''}</td>
                        <td>${transaction.batchNumber || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function populateInwardsTransactions(inwards, products, remarks) {
            const tbody = document.getElementById('inwardsTransactionsBody');
            
            if (inwards.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5"><p>No inwards transactions</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = inwards.map(transaction => {
                const product = products.find(p => p.id === transaction.productId);
                const remark = remarks.find(r => r.id === transaction.remarkId);
                return `
                    <tr>
                        <td>${formatDate(transaction.dateTime)}</td>
                        <td><strong>${parseFloat(transaction.quantity).toFixed(2)}</strong></td>
                        <td>${remark?.name || '-'}</td>
                        <td>${transaction.batchNumber || '-'}</td>
                        <td>${transaction.additionalRemarks || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function populateOutwardsTransactions(outwards, products, remarks) {
            const tbody = document.getElementById('outwardsTransactionsBody');
            
            if (outwards.length === 0) {
                tbody.innerHTML = '<tr class="empty-state"><td colspan="5"><p>No outwards transactions</p></td></tr>';
                return;
            }
            
            tbody.innerHTML = outwards.map(transaction => {
                const product = products.find(p => p.id === transaction.productId);
                const remark = remarks.find(r => r.id === transaction.remarkId);
                return `
                    <tr>
                        <td>${formatDate(transaction.dateTime)}</td>
                        <td><strong>${parseFloat(transaction.quantity).toFixed(2)}</strong></td>
                        <td>${remark?.name || '-'}</td>
                        <td>${transaction.batchNumber || '-'}</td>
                        <td>${transaction.additionalRemarks || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function closeTransactionModal() {
            document.getElementById('transactionModal').classList.remove('active');
        }

        function switchTransactionTab(tabName) {
            // Hide all transaction contents
            document.querySelectorAll('.transaction-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.transaction-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Fallback: find and highlight the button that matches the tab
                document.querySelectorAll('.transaction-tab-btn').forEach(btn => {
                    if (btn.getAttribute('onclick').includes(`'${tabName}'`)) {
                        btn.classList.add('active');
                    }
                });
            }
        }

        // ============ AUTHENTICATION HANDLERS ============
        
        async function handleLogin(email, password) {
            showLoading('loginBtn', true);
            
            try {
                // For simplicity, we'll use Firebase Authentication
                // Pre-create an admin user in Firebase Console with:
                // Email: admin@tyrone.com
                // Password: admin123
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                
                showLoginPage(false);
                initializeDashboard();
                return true;
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Login failed. Please try again.';
                
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No account found. Use: admin@tyrone.com / admin123';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Incorrect password. Use: admin123';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address.';
                }
                
                showAlert('loginError', errorMessage, 'error');
                return false;
            } finally {
                showLoading('loginBtn', false);
            }
        }

        async function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await auth.signOut();
                    showLoginPage(true);
                    document.getElementById('loginForm').reset();
                    document.getElementById('loginError').style.display = 'none';
                } catch (error) {
                    console.error('Logout error:', error);
                    showAlert('productError', 'Logout failed. Please try again.', 'error');
                }
            }
        }

        // ============ INITIALIZATION ============
        
        async function initializeDashboard() {
            // Set current date/time in forms
            document.getElementById('inwardsDate').value = getCurrentDateTime();
            document.getElementById('outwardsDate').value = getCurrentDateTime();
            
            // Load all data
            await loadProducts();
            await loadRemarks();
            await loadInwards();
            await loadOutwards();
            await updateLiveStock();
        }

        function initializeApp() {
            // Set up Firebase auth state observer
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    // User is signed in
                    showLoginPage(false);
                    await initializeDashboard();
                } else {
                    // User is signed out
                    showLoginPage(true);
                }
            });
            
            // ============ EVENT LISTENERS ============
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                await handleLogin(email, password);
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchTab(btn.getAttribute('data-tab'));
                });
            });
            
            // Product form
            document.getElementById('productForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const productName = document.getElementById('productName').value;
                await addProduct(productName);
            });
            
            // Remark form
            document.getElementById('remarkForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const remarkName = document.getElementById('remarkName').value;
                const remarkType = document.getElementById('remarkType').value;
                await addRemark(remarkName, remarkType);
            });
            
            // Inwards form
            document.getElementById('inwardsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const productId = document.getElementById('inwardsProduct').value;
                const quantity = document.getElementById('inwardsQuantity').value;
                const remarkId = document.getElementById('inwardsRemark').value;
                const batchNumber = document.getElementById('inwardsBatchNumber').value;
                const additionalRemarks = document.getElementById('inwardsAdditionalRemarks').value;
                const dateTime = document.getElementById('inwardsDate').value;
                await addInwardsRecord(productId, quantity, remarkId, batchNumber, additionalRemarks, dateTime);
            });
            
            // Outwards form
            document.getElementById('outwardsForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const productId = document.getElementById('outwardsProduct').value;
                const quantity = document.getElementById('outwardsQuantity').value;
                const remarkId = document.getElementById('outwardsRemark').value;
                const batchNumber = document.getElementById('outwardsBatchNumber').value;
                const additionalRemarks = document.getElementById('outwardsAdditionalRemarks').value;
                const dateTime = document.getElementById('outwardsDate').value;
                await addOutwardsRecord(productId, quantity, remarkId, batchNumber, additionalRemarks, dateTime);
            });
            
            // Update date/time when inwards form is focused
            document.getElementById('inwardsForm').addEventListener('focus', () => {
                document.getElementById('inwardsDate').value = getCurrentDateTime();
            }, true);
            
            // Update date/time when outwards form is focused
            document.getElementById('outwardsForm').addEventListener('focus', () => {
                document.getElementById('outwardsDate').value = getCurrentDateTime();
            }, true);

            // Close modal when clicking outside of it
            document.getElementById('transactionModal').addEventListener('click', (e) => {
                if (e.target.id === 'transactionModal') {
                    closeTransactionModal();
                }
            });
        }

        // Start app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
